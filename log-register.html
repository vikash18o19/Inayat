<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="x-ua-compatiable " content="ie=edge" />
    <title>Inayat &#45; Login &#47; Register</title>
    <link rel="stylesheet" href="css/log-register.css" />

    <link
      href="https://fonts.googleapis.com/css2?family=Anton&family=EB+Garamond:wght@400;600;700&family=MonteCarlo&family=Oswald:wght@300;400;500;700&family=Poppins:wght@100;300;400;600;700&family=STIX+Two+Text:ital,wght@0,400;0,500;0,600;0,700;1,400&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://use.fontawesome.com/releases/v5.12.0/css/all.css"
    />
    <link
      rel="stylesheet"
      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"
    />

    <!--====== Favicon Icon ======-->
    <link rel="shortcut icon" href="images/favicon.png" type="image/png" />
  </head>

  <body bgcolor="#59bfff">
    <!-- bgcolor="#728FCE" -->

    <div class="container">
      <div class="logo">
        <img
          src="images/IN.png"
          width="100px"
          height="100px"
          alt="Inayat"
        /><br />
      </div>
      <h1>Welcome to INAYAT!</h1>
    </div>
    <div class="form-box">
      <div class="button-box">
        <div id="btn"></div>
        <button type="button" class="toggle-btn">
          Log In
        </button>
        <button type="button" class="toggle-btn">
          Register
        </button>
      </div>

      <form id="login" class="input-group">
        <input type="text" class="input-field" placeholder="User Id" required />
        <input
          type="text"
          class="input-field"
          placeholder="Enter Password"
          required
        />
        <input type="checkbox" class="chech-box" /><span
          >Remember Password</span
        >
        <button type="submit" class="submit-btn" onclick="login()">Log In</button>
      </form>

      <form id="register" class="input-group">
        <div class="dropdown">
          <input type="hidden" />
          <select id="'type" onchange="getType()">
            <option style="font-family: 'arial'">Login as</option>
            <option>Student</option>
            <option value="">Intern</option>
            <option value="">Mentor</option>
            <option value="">Employee</option>
          </select>
        </div>
        <br /><br />
        <input type="text" class="input-field" id="full_name" placeholder="Name" required />
        <input type="text" class="input-field" id="contact" placeholder="Contact" required />
        <input
          type="email"
          class="input-field"
          id="email"
          placeholder="Email Id"
          required
        />
        <input
          type="text"
          class="input-field"
          id="password"
          placeholder="Enter Password"
          required
        />
        <input type="checkbox" class="chech-box" /><span
          >I agree to the terms and conditions.</span
        >
        <button type="submit" class="submit-btn" onclick="register()">Register</button>
      </form>

      <!-------Social Icons Starts------->

      <div class="social-icons">
        <a href="https://www.facebook.com/nurturethenurturers/"
          ><i class="fa fa-facebook"></i
        ></a>
        <a href="https://www.instagram.com/___i_n_a_y_a_t___/"
          ><i class="fa fa-instagram"></i
        ></a>
        <a href="https://www.linkedin.com/company/nurturethenurturers/"
          ><i class="fa fa-linkedin"></i
        ></a>
        <button  id="login_id">
          <i class="fab fa-google fa-2x" style="font-size: 23px"></i
        ></a>
      </div>

      <!-------Social Icons Ends------->
    </div>

    <script>
      var x = document.getElementById("login");
      var y = document.getElementById("register");
      var z = document.getElementById("btn");

      function register() {
        x.style.left = "-400px";
        y.style.left = "50px";
        z.style.left = "110px";
      }

      function login() {
        x.style.left = "50px";
        y.style.left = "450px";
        z.style.left = "0";
      }
    </script>
  </body>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-analytics.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup, 
      createUserWithEmailAndPassword,
      signOut
    } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-auth.js";

    import { getDatabase } from "https://www.gstatic.com/firebasejs/9.8.1/firebase-database.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyDr47pbikNwJGQxiKmbSnM7QgMJOv3W130",
      authDomain: "inayat-backend.firebaseapp.com",
      projectId: "inayat-backend",
      storageBucket: "inayat-backend.appspot.com",
      messagingSenderId: "248131097417",
      appId: "1:248131097417:web:ac2066b2578b7eefa20098",
      measurementId: "G-QK3T4RQR8Q",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider(app);
    const database = firebase.database()
    //LOGIN USING GOOGLE ACCOUNT

    login_id.addEventListener("click", (e) => {
      
      // sign in with popup tab
      signInWithPopup(auth, provider)
        .then((result) => {
          // This gives you a Google Access Token. You can use it to access the Google API.
          const credential = GoogleAuthProvider.credentialFromResult(result);
          const token = credential.accessToken;
          // The signed-in user info.
          const user = result.user;


          alert(user.displayName);
          // ...
        }).catch((error) => {
          // Handle Errors here.
          const errorCode = error.code;
          const errorMessage = error.message;
          // The email of the user's account used.
          const email = error.customData.email;
          // The AuthCredential type that was used.
          const credential = GoogleAuthProvider.credentialFromError(error);
          // ...
        });
    });

    signOut.addEventListener('click',(e) => {

   signOut(auth).then(() => {
    // Sign-out successful.
   }).catch((error) => {
    // An error happened.
   });

  });

  //**********************************************************
  
  function getType(){
    value = document.getElementById('type');
    gettext = value.options[value.selectedIndex].text;

    return gettext

  }
//Set up our Register function

  function register(){
    // Get all our input fields
    email =document.getElementById('email').value
    password =document.getElementById('password').value
    full_name =document.getElementById('full_name').value
    contact =document.getElementById('contact').value
    type = getType()

    //validate the input fields
    if(validate_email(email)==false || validate_password(password)==false){
      alert('Email or password is outta line !!')
      return 
    }

    if(validate_fields(full_name)==false || validate_fields(contact)==false || validate_fields(type)==false){
      alert('One or more extra field is outta Line!!')
      return
    }

    auth.createUserWithEmailAndPassword(email, password)
    .then(function(){
      //Declare user variable
      var user =auth.currentUser

      // Add this user to firebase database

      var database_ref =database.ref()

      //create User data

      var user_data={
        email : email,
        full_name : full_name,
        contact : contact,
        type : type,
        last_login : Data.now()
      }

      database_ref.child('users/'+ user.uid).set(user_data)

      alert('User Created')
    })
    .catch(function(error){

      var error_code =error.code
      var error_message= error.message

      alert(error_message)
    })
  }
  
  //Set up our login function

  function login(){
    //Get all our input fields
    email =document.getElementById('email').value
    password =document.getElementById('password').value

    //Also validate 
    if(validate_email(email)==false || validate_password(password)==false){
      alert('Email or password is outta line !!')
      return 
    }

    auth.signInWithEmailAndPassword(email, password)
    .then(function(){
      //Declare user variable
      var user =auth.currentUser

      // Add this user to firebase database

      var database_ref =database.ref()

      //create User data

      var user_data={
        last_login : Data.now()
      }

      database_ref.child('users/'+ user.uid).update(user_data)

      alert('User Logged In!!')

    }).catch(function(error){
      var error_code =error.code
      var error_message= error.message

      alert(error_message)
    })

  }

  function validate_email(email){
    expression=/^[^@]+@\w+(\.\w+)+\w$/.test(str);
    if(expression.test(email)==true){
      return true
    }
    else{
      return false
    }
  }

  function validate_password(password){
    if(password<6){
      return false
    }else{
      return true
    }
  }

  function validate_fields(field){
    if(field==null){
      return false
    }

    if(field.length<=0){
      return false
    }else{
      return true
    }
  }

  </script>
  
</html>
